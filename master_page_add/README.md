# Master Page Add

Скрипт **masterPageAdd.py** проверяет наличие h2.unnum в топиках и подставляет соответствующий Master Page.
Обрабатываются все htm-файлы проекта, начиная с каталога, в котором запущен скрипт:
* Если есть h2.unnum — смотрим теги у каждого из найденных заголовков:
  - Если все заголовки с Additional, Obsolete, Expectation или тегом из набора Tasks — пропускаем.
  - Если есть хотя бы 1 заголовок без перечисленных тегов — смотрим мастерпейдж:
    + С меню — пропускаем.
    + Без меню — заменяем на мастерпейдж с меню.
* Если h2.unnum нет — смотрим мастерпейдж:
  - С меню — проверяем наличие сниппета:
    + Сниппет есть — ничего не делаем. Топик заносим в лог для ручной проверки (будет доработано в дальнейшем).
    + Сниппета нет — заменяем на мастерпейдж без меню.
  - Без меню — пропускаем.
  - Мастерпейдж не указан (default) — пропускаем.

## Установка

Для работы скрипта установите следующие компоненты:

* Библиотека [Beautiful Soup 4](https://www.crummy.com/software/BeautifulSoup/bs4/doc.ru/bs4ru.html).
* Парсер [XML](https://www.crummy.com/software/BeautifulSoup/bs4/doc.ru/bs4ru.html#parser-installation).

## Быстрый старт

Для добавления Master Page в топики:

1. Поместите скрипт в корневой каталог, из которого начнется поиск файлов топиков в подкаталогах.
2. Запустите скрипт.
3. Включите дополнительное логирование в консоли при необходимости:
   * 1 — логирование включено.
   * 0 — логирование выключено.
4. Дождитесь завершения работы скрипта.

## Настройка скрипта

В скрипте доступна настройка с помощью переменных:

* _root_dir_ — директория, из которой начнется поиск файлов. По умолчанию используется каталог, в котором расположен скрипт.
При необходимости можно указать абсолютный путь до другого каталога, в этом случае перемещать скрипт в указанный каталог не нужно.
* _file_extension_ — расширение обрабатываемых файлов.
* _root_dir_name_ — название каталога, от которого рассчитывается относительный путь для вставки Master Page.
* _masterpage_with_menu_ — файл Master Page с боковым меню. Указывается с расширением.
* _masterpage_without_menu_ — файл Master Page без бокового меню. Указывается с расширением.
* _exclude_conditions_ — список MadCap:conditions, которые исключаются в проекте.

## Логи

Файлы логов создаются в том же каталоге, где расположен скрипт:

* Основной лог _execution.log_ содержит полный ход выполнения скрипта. Он сохраняется всегда.
* Дополнительные логи сохраняются при включении логирования после запуска скрипта:
  * _masterpage_added.log_ — файлы, в которые добавлен параметр **mc-master-page**.
  * _not_changed.log_ — не измененные файлы, в которых Master Page уже указан.
  * _manual_check_needed.log_ — не измененные файлы, в которых указан Master Page с боковым меню, хотя h2.unnum не найден.
    Требуется ручная проверка, возможно заголовки расположены внутри сниппетов.

В дополнительных логах также отображается содержимое атрибута **style** тега **\<html\>** каждого указанного файла.

Файлы логов удаляются при каждом запуске скрипта.